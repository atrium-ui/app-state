<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>app-state | Input Example</title>

  <link rel="stylesheet" href="../examples.css">

  <script src="../../dist/app-state.min.js"></script>

  <script>
    // Compoennt to directly print out state value
    customElements.define("text-display", class extends HTMLElement {
      set value(val) {
        this.innerHTML = val;
      }
    })
  </script>
</head>

<body>
  <h1>App State Input Example</h1>

  <div class="layout">
    <div>
      <app-state scope="examples">
        <input state-key="title" placeholder="Type here" />
        <br>

        <div>
          <span>State value:</span>
          <text-display state-key="title"></text-display>
        </div>
      </app-state>
    </div>

    <div>
      <app-state scope="examples">
        <input type="range" state-key="range" placeholder="Type here" />
        <br>

        <div>
          <span>State value:</span>
          <text-display state-key="range">0</text-display>
        </div>
      </app-state>
    </div>

    <div>
      <app-state scope="examples">
        <select state-key="option">
          <option>Default</option>
          <option>Test1</option>
          <option>Test2</option>
          <option>Test3</option>
        </select>
        <br>

        <div>
          <span>State value:</span>
          <text-display state-key="option">Default</text-display>
        </div>
      </app-state>
    </div>
  </div>

  <div class="container">
    <button id="statePrintBtn">Save State</button>
    <button id="roleBackPrintBtn">Role Back</button>
    <br>

    <script type="module">
      let prevState = {};
      let lastState = {};

      const copy = state => JSON.parse(JSON.stringify(state));

      statePrintBtn.onclick = () => {
        const currentState = copy(State.getState("examples"));

        const stateDifference = State.subtractState(lastState, currentState);
        stateDiff.innerHTML = JSON.stringify(stateDifference, null, "\t");

        lastStateEle.innerHTML = JSON.stringify(lastState, null, "\t");

        currState.innerHTML = JSON.stringify(State.mergeState(lastState, stateDifference), null, "\t");

        prevState = copy(lastState);
        lastState = currentState;
      }

      roleBackPrintBtn.onclick = () => {
        State.deleteScope('examples');
        State.setState('examples', prevState);
      }
    </script>

    <div>Previous State:</div>
    <pre id="lastStateEle"></pre>

    <div>State difference:</div>
    <pre id="stateDiff"></pre>
    
    <div>Merged State:</div>
    <pre id="currState"></pre>
  </div>
</body>

</html>